<div class="container py-3">
    <h2 class="mb-3">Reportes de ventas</h2>

    <div class="controls">
        <button [class.active]="periodo==='24h'" (click)="cambiarPeriodo('24h')">Últimas 24h</button>
        <button [class.active]="periodo==='7d'" (click)="cambiarPeriodo('7d')">Últimos 7 días</button>
        <button [class.active]="periodo==='30d'" (click)="cambiarPeriodo('30d')">Últimos 30 días</button>
    </div>

    <div class="chart-card" *ngIf="isBrowser">
        <h5>Unidades vendidas por día</h5>
        <canvas baseChart [data]="ventasCfg" [type]="'line'"></canvas>
    </div>

    <div class="chart-card" *ngIf="isBrowser">
        <h5>Top 3 productos más vendidos</h5>
        <canvas baseChart [data]="topCfg" [type]="'bar'"></canvas>
    </div>

    <div class="d-flex align-items-center justify-content-between mt-4">
        <h4 class="mb-0">Histórico de compras (por ítem)</h4>
        <button class="btn-export" (click)="exportarCSV()">Exportar CSV</button>
    </div>

    <div class="table-wrap">
        <table>
            <thead>
                <tr>
                    <th>Fecha</th>
                    <th>Usuario</th>
                    <th>Producto</th>
                    <th>Categoría</th>
                    <th>Cant.</th>
                    <th>Precio ARS</th>
                    <th>Total ARS</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let r of rows">
                    <td>{{ formatearFecha(r.ts) }}</td>
                    <td>{{ r.usuario }}</td>
                    <td>{{ r.producto }}</td>
                    <td>{{ r.categoria }}</td>
                    <td class="num">{{ r.cantidad }}</td>
                    <td class="num">{{ r.precioARS | number:'1.2-2' }}</td>
                    <td class="num">{{ r.totalItemARS | number:'1.2-2' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="mt-3 center">
        <button (click)="cargarMas()" [disabled]="!lastSnap || cargando">
            {{ cargando ? 'Cargando…' : (lastSnap ? 'Cargar más' : 'No hay más') }}
        </button>
    </div>
</div>