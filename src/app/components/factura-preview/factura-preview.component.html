<h4 class="mb-4 text-center">Detalle de Factura</h4>

<table class="table table-bordered">
  <thead class="table-dark">
    <tr>
      <th>Producto</th>
      <th>Categoría</th>
      <th>Cantidad</th>
      <th>Precio (ARS)</th>
      <th>Subtotal (ARS)</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let item of items">
      <td>{{ (item?.producto?.nombre || item?.producto?.name) || '—' }}</td>
      <td>{{ (item?.producto?.categoria || item?.producto?.category) || '—' }}</td>
      <td>{{ item?.cantidad ?? 0 }}</td>

      <!-- precio con fallback a priceARS -->
      <td>
        $ {{
        (item?.producto?.precio ?? item?.producto?.priceARS ?? 0)
        | number:'1.2-2'
        }}
      </td>

      <!-- usa método seguro del componente -->
      <td>
        $ {{ calcSubtotal(item) | number:'1.2-2' }}
      </td>

      <td>
        <button class="btn btn-sm btn-outline-danger" (click)="eliminarProducto(item?.producto?.id)"
          [disabled]="!item?.producto?.id">
          Eliminar
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div class="text-end">
  <p><strong>Total ARS:</strong> $ {{ totalARS | number:'1.2-2' }}</p>
  <p><strong>Total USD:</strong> U$D {{ totalUSD | number:'1.2-2' }}</p>
  <button class="btn btn-success mt-3" (click)="confirmarCompra()" [disabled]="(items?.length ?? 0) === 0">
    Confirmar compra
  </button>

</div>